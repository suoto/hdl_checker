# content of: tox.ini , put in same dir as setup.py
[tox]
envlist = {py27,py37}-{msim,ghdl,fallback,standalone}

[testenv]
# install pytest in the virtualenv where commands will be executed
deps =
    argcomplete==1.4.1
    codecov==2.0.5
    colorama==0.3.7
    cov-core==1.15.0
    coverage==4.1
    coveralls==1.1
    docopt==0.6.2
    funcsigs==1.0.2
    future>=0.14.0
    logutils==0.3.3
    mock==2.0.0
    nose2-cov==1.0a4
    nose2==0.6.5
    pbr==1.10.0
    prettytable==0.7.2
    requests==2.20.0
    six==1.10.0
    testfixtures==4.10.0
    vunit-hdl==0.66.0
    WebTest==2.0.23
    git+https://github.com/suoto/rainbow_logging_handler

# NOTE: you can run any command line tool here - not just tests
whitelist_externals =
    git
    /bin/bash

commands_pre:
    msim:  bash -c "HOME={env:HOME:} ./.ci/scripts/setup_msim.sh"
    ghdl:  bash -c "HOME={env:HOME:} ./.ci/scripts/setup_ghdl.sh"
    xvhdl: bash -c "HOME={env:HOME:} ./.ci/scripts/setup_xvhdl.sh"

commands =
    # Clone test support stuff into the tox env dir so we can run tests in parallel

    # To speed up debugging, copy from somewhere
    # bash -c '[ -d "{env:HOME:}/cache/grlib" ] && \
    #     cp -ar "{env:HOME:}/cache/grlib" "{envtmpdir}/grlib"'
    # bash -c '[ -d "{env:HOME:}/cache/vim-hdl-examples" ] && \
    #     cp -ar "{env:HOME:}/cache/vim-hdl-examples" {envtmpdir}/vim-hdl-examples'

    bash -c '[ -d "{env:HOME:}/cache/grlib" ] || \
        git clone https://github.com/suoto/grlib "{envtmpdir}/grlib" --depth 1'

    bash -c '[ -d "{env:HOME:}/cache/vim-hdl-examples" ] || \
        git clone https://github.com/suoto/vim-hdl-examples \
            {envtmpdir}/vim-hdl-examples --depth 1'

    msim:       ./run_tests.py -v --log-level DEBUG --fail-fast --msim
    ghdl:       ./run_tests.py -v --log-level DEBUG --fail-fast --ghdl
    fallback:   ./run_tests.py -v --log-level DEBUG --fail-fast --fallback
    standalone: ./run_tests.py -v --log-level DEBUG --fail-fast --standalone
    xvhdl:      ./run_tests.py -v --log-level DEBUG --fail-fast --xvhdl
